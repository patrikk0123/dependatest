{"ast":null,"code":"import { useCallback, useEffect, useRef, useState } from 'react';\nexport const useDataBuffer = function () {\n  let preprocessor = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : lines => lines;\n  const [data, setData] = useState([]);\n  const [buffer, setBuffer] = useState([]);\n  const [currentLineCount, setCurrentLineCount] = useState(1);\n  const savedTimer = useRef();\n  const dataLen = useRef(data.length);\n  dataLen.current = data.length;\n  useEffect(() => {\n    savedTimer.current = setInterval(() => {\n      setCurrentLineCount(dataLen.current);\n    }, 2000);\n  }, []); // useEffect(() => {\n  //   if (data.length > buffer.length) {\n  //     savedTimer.current = setTimeout(() => {\n  //       setCurrentLineCount((currentLineCount) => currentLineCount + 5);\n  //     }, 1500);\n  //   }\n  //   return () => {\n  //     clearTimeout(savedTimer.current);\n  //   };\n  // }, [data.length, buffer.length]);\n\n  useEffect(() => {\n    if (data.length > buffer.length) setBuffer(data.slice(0, currentLineCount)); // if (currentLineCount > initLogData.length) {\n    //   clearInterval(savedTimer.current);\n    // } else {\n    //   // setLogData(initLogData.slice(0, currentLineCount));\n    //   addLines(initLogData.slice(currentLineCount - 3, currentLineCount));\n    // }\n  }, [currentLineCount]); // useEffect(() => {\n  //   setTimeout(() => {\n  //     setBuffer(data);\n  //   }, 3000);\n  // }, [data]);\n\n  const addLines = useCallback(lines => {\n    setData([...data, ...preprocessor(lines)]);\n  }, [data, preprocessor]);\n  return {\n    buffer,\n    addLines\n  };\n};","map":{"version":3,"names":["useCallback","useEffect","useRef","useState","useDataBuffer","preprocessor","lines","data","setData","buffer","setBuffer","currentLineCount","setCurrentLineCount","savedTimer","dataLen","length","current","setInterval","slice","addLines"],"sources":["/home/pkorytar/Projects/RedHat/pnc-web-ui-react/src/containers/useDataBuffer.ts"],"sourcesContent":["import { MutableRefObject, useCallback, useEffect, useRef, useState } from 'react';\n\nexport const useDataBuffer = (preprocessor: Function = (lines: string[]) => lines) => {\n  const [data, setData] = useState<string[]>([]);\n  const [buffer, setBuffer] = useState<string[]>([]);\n  const [currentLineCount, setCurrentLineCount] = useState<number>(1);\n  const savedTimer: MutableRefObject<NodeJS.Timer | undefined> = useRef();\n  const dataLen = useRef<number>(data.length);\n  dataLen.current = data.length;\n\n  useEffect(() => {\n    savedTimer.current = setInterval(() => {\n      setCurrentLineCount(dataLen.current);\n    }, 2000);\n  }, []);\n\n  // useEffect(() => {\n  //   if (data.length > buffer.length) {\n  //     savedTimer.current = setTimeout(() => {\n  //       setCurrentLineCount((currentLineCount) => currentLineCount + 5);\n  //     }, 1500);\n  //   }\n  //   return () => {\n  //     clearTimeout(savedTimer.current);\n  //   };\n  // }, [data.length, buffer.length]);\n\n  useEffect(() => {\n    if (data.length > buffer.length) setBuffer(data.slice(0, currentLineCount));\n    // if (currentLineCount > initLogData.length) {\n    //   clearInterval(savedTimer.current);\n    // } else {\n    //   // setLogData(initLogData.slice(0, currentLineCount));\n    //   addLines(initLogData.slice(currentLineCount - 3, currentLineCount));\n    // }\n  }, [currentLineCount]);\n\n  // useEffect(() => {\n  //   setTimeout(() => {\n  //     setBuffer(data);\n  //   }, 3000);\n  // }, [data]);\n\n  const addLines = useCallback(\n    (lines: string[]) => {\n      setData([...data, ...preprocessor(lines)]);\n    },\n    [data, preprocessor]\n  );\n\n  return { buffer, addLines };\n};\n"],"mappings":"AAAA,SAA2BA,WAA3B,EAAwCC,SAAxC,EAAmDC,MAAnD,EAA2DC,QAA3D,QAA2E,OAA3E;AAEA,OAAO,MAAMC,aAAa,GAAG,YAAyD;EAAA,IAAxDC,YAAwD,uEAA9BC,KAAD,IAAqBA,KAAU;EACpF,MAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBL,QAAQ,CAAW,EAAX,CAAhC;EACA,MAAM,CAACM,MAAD,EAASC,SAAT,IAAsBP,QAAQ,CAAW,EAAX,CAApC;EACA,MAAM,CAACQ,gBAAD,EAAmBC,mBAAnB,IAA0CT,QAAQ,CAAS,CAAT,CAAxD;EACA,MAAMU,UAAsD,GAAGX,MAAM,EAArE;EACA,MAAMY,OAAO,GAAGZ,MAAM,CAASK,IAAI,CAACQ,MAAd,CAAtB;EACAD,OAAO,CAACE,OAAR,GAAkBT,IAAI,CAACQ,MAAvB;EAEAd,SAAS,CAAC,MAAM;IACdY,UAAU,CAACG,OAAX,GAAqBC,WAAW,CAAC,MAAM;MACrCL,mBAAmB,CAACE,OAAO,CAACE,OAAT,CAAnB;IACD,CAF+B,EAE7B,IAF6B,CAAhC;EAGD,CAJQ,EAIN,EAJM,CAAT,CARoF,CAcpF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEAf,SAAS,CAAC,MAAM;IACd,IAAIM,IAAI,CAACQ,MAAL,GAAcN,MAAM,CAACM,MAAzB,EAAiCL,SAAS,CAACH,IAAI,CAACW,KAAL,CAAW,CAAX,EAAcP,gBAAd,CAAD,CAAT,CADnB,CAEd;IACA;IACA;IACA;IACA;IACA;EACD,CARQ,EAQN,CAACA,gBAAD,CARM,CAAT,CAzBoF,CAmCpF;EACA;EACA;EACA;EACA;;EAEA,MAAMQ,QAAQ,GAAGnB,WAAW,CACzBM,KAAD,IAAqB;IACnBE,OAAO,CAAC,CAAC,GAAGD,IAAJ,EAAU,GAAGF,YAAY,CAACC,KAAD,CAAzB,CAAD,CAAP;EACD,CAHyB,EAI1B,CAACC,IAAD,EAAOF,YAAP,CAJ0B,CAA5B;EAOA,OAAO;IAAEI,MAAF;IAAUU;EAAV,CAAP;AACD,CAjDM"},"metadata":{},"sourceType":"module"}