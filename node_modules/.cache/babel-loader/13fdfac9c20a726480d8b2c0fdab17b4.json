{"ast":null,"code":"import { useCallback, useEffect, useState } from 'react'; // import { copyAndSetValues } from '../utils/utils';\n\n/**\n * Hook to manage input values, validation and states of a form.\n * All validation is done on change of input.\n * Submit button is firstly disabled. In order to enable button:\n *  -> at least one change must be done\n *  -> all required fields must not be empty\n *  -> all validated inputs must be valid\n *\n * See also {@link ProjectCreateEditPage}\n *\n * @param initValues - Values to initialize inputs with\n * @param validators - Objects consisting of whether is input required and validation function\n * @param callback - Function to call when submitting user input data\n *\n * @returns form states and access functions\n *  -> fieldValues - values of input fields\n *  -> fieldErrors - error messages of inout fields\n *  -> fieldStates - 'default' | 'success' | 'error'\n *  -> isSubmitDisabled - submit disabled or not\n *  -> onChange - callback for input fields on change\n *  -> setFieldValues - set all field values\n *  -> onSubmit - callback for submit button\n *\n * initValues, validators, fieldValues, fieldErrors, fieldStates are objects whose keys are equal to ids of inputs fields.\n * example: validators.projectUrl.isRequired\n */\nexport const useForm = (initForm, callback) => {\n  const defaultForm = { ...initForm\n  };\n\n  for (const key in defaultForm) {\n    defaultForm[key].state = 'default';\n  }\n\n  const [form, setForm] = useState(defaultForm); // is submit button disabled?\n\n  const [isSubmitDisabled, setIsSubmitDisabled] = useState(true); // has any field been changed?\n  // important for edit page (do not submit until any new content)\n\n  const [hasChanged, setHasChanged] = useState(false); // // input values\n  // const [fieldValues, setFieldValues] = useState<IFieldValues>(initValues);\n  // // input error messages\n  // const [fieldErrors, setFieldErrors] = useState<IFieldErrors>({});\n  // // inpur validation functions\n  // const [fieldValidators] = useState<IFieldValidators>(validators);\n  // const initFieldStates = copyAndSetValues(initValues, 'default');\n  // // input states - 'default' | 'success' | 'error'\n  // const [fieldStates, setFieldStates] = useState<any>(initFieldStates);\n  // are all validated inputs valid?\n\n  const isFormValid = useCallback(() => {\n    for (const key in form) {\n      if (form[key].errorMessage) return false;\n    }\n\n    return true;\n  }, [form]); // are all required inputs filled?\n\n  const areRequiredFilled = useCallback(() => {\n    for (const key in form) {\n      const validator = form[key].validator;\n\n      if (validator) {\n        if (validator.isRequired && !form[key].value) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  }, [form]); // callback (on change of input)\n\n  const onChange = event => {\n    const fieldName = event.currentTarget.name;\n    const fieldValue = event.currentTarget.value;\n    const newField = { ...form[fieldName],\n      value: fieldValue\n    };\n    const validatedField = validate(newField);\n    setForm({ ...form,\n      [fieldName]: validatedField\n    });\n    console.log(fieldValue);\n    setHasChanged(true);\n  }; // validate field\n\n\n  const validate = newField => {\n    const validator = newField.validator;\n\n    if (validator) {\n      if (validator.isRequired) {\n        const error = newField.value ? '' : 'Field must be filled!';\n        return setError(newField, error);\n      } else if (validator.check) {\n        const error = validator.check(newField.value);\n        return setError(newField, error);\n      }\n    }\n\n    return { ...newField\n    };\n  }; // set error message and state\n\n\n  const setError = (newField, error) => {\n    if (error) {\n      return { ...newField,\n        errorMessage: error,\n        state: 'error'\n      };\n    } else {\n      // if no error, delete old error (if any)\n      // const newErrors = { ...fieldErrors };\n      // delete newErrors[fieldName];\n      // setFieldErrors(newErrors);\n      // display success state only if not empty\n      if (newField.value) {\n        return { ...newField,\n          errorMessage: error,\n          state: 'success'\n        };\n      } else {\n        return { ...newField,\n          errorMessage: error,\n          state: 'default'\n        };\n      }\n    }\n  };\n\n  const generateSubmitData = form => {\n    const formData = {};\n\n    for (const key in form) {\n      formData[key] = form[key].value;\n    }\n\n    return formData;\n  }; // callback (on submit of form)\n\n\n  const onSubmit = () => {\n    callback(generateSubmitData(form)); // reset state to 'default' (valid inputs wont be highlighted)\n\n    const formCopy = { ...form\n    };\n\n    for (const key in formCopy) {\n      formCopy[key].state = 'default';\n    }\n\n    setForm(formCopy);\n    setIsSubmitDisabled(true);\n  };\n\n  const setFieldValues = useCallback(fieldValues => {\n    const newForm = { ...form\n    };\n    console.log(newForm, fieldValues);\n\n    for (const key in fieldValues) {\n      console.log(newForm[key], fieldValues[key]);\n      newForm[key]['value'] = fieldValues[key];\n    }\n\n    setForm(newForm);\n  }, [form]);\n  useEffect(() => {\n    if (isFormValid() && areRequiredFilled() && hasChanged) {\n      setIsSubmitDisabled(false);\n    } else {\n      setIsSubmitDisabled(true);\n    }\n  }, [form, hasChanged, isFormValid, areRequiredFilled]);\n  return {\n    form,\n    isSubmitDisabled,\n    onChange,\n    setFieldValues,\n    onSubmit\n  };\n};","map":{"version":3,"names":["useCallback","useEffect","useState","useForm","initForm","callback","defaultForm","key","state","form","setForm","isSubmitDisabled","setIsSubmitDisabled","hasChanged","setHasChanged","isFormValid","errorMessage","areRequiredFilled","validator","isRequired","value","onChange","event","fieldName","currentTarget","name","fieldValue","newField","validatedField","validate","console","log","error","setError","check","generateSubmitData","formData","onSubmit","formCopy","setFieldValues","fieldValues","newForm"],"sources":["/home/pkorytar/Projects/RedHat/pnc-web-ui-react/src/containers/useForm.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\n// import { copyAndSetValues } from '../utils/utils';\n\ninterface IFieldValues {\n  [key: string]: string;\n}\n\n// interface IFieldErrors {\n//   [key: string]: string | undefined;\n// }\n\n// interface IFieldValidators {\n//   [key: string]: IValidator;\n// }\n\ninterface IValidator {\n  isRequired?: boolean;\n  check?: Function;\n}\n\ninterface IFieldState {\n  value: string;\n  errorMessage?: string;\n  state?: any;\n  validator?: IValidator;\n}\n\ninterface IFormState {\n  [key: string]: IFieldState;\n}\n\n/**\n * Hook to manage input values, validation and states of a form.\n * All validation is done on change of input.\n * Submit button is firstly disabled. In order to enable button:\n *  -> at least one change must be done\n *  -> all required fields must not be empty\n *  -> all validated inputs must be valid\n *\n * See also {@link ProjectCreateEditPage}\n *\n * @param initValues - Values to initialize inputs with\n * @param validators - Objects consisting of whether is input required and validation function\n * @param callback - Function to call when submitting user input data\n *\n * @returns form states and access functions\n *  -> fieldValues - values of input fields\n *  -> fieldErrors - error messages of inout fields\n *  -> fieldStates - 'default' | 'success' | 'error'\n *  -> isSubmitDisabled - submit disabled or not\n *  -> onChange - callback for input fields on change\n *  -> setFieldValues - set all field values\n *  -> onSubmit - callback for submit button\n *\n * initValues, validators, fieldValues, fieldErrors, fieldStates are objects whose keys are equal to ids of inputs fields.\n * example: validators.projectUrl.isRequired\n */\nexport const useForm = (initForm: Omit<Omit<IFormState, 'errorMessage'>, 'state'>, callback: Function) => {\n  const defaultForm = { ...initForm };\n  for (const key in defaultForm) {\n    defaultForm[key].state = 'default';\n  }\n  const [form, setForm] = useState<IFormState>(defaultForm);\n\n  // is submit button disabled?\n  const [isSubmitDisabled, setIsSubmitDisabled] = useState<boolean>(true);\n  // has any field been changed?\n  // important for edit page (do not submit until any new content)\n  const [hasChanged, setHasChanged] = useState<boolean>(false);\n\n  // // input values\n  // const [fieldValues, setFieldValues] = useState<IFieldValues>(initValues);\n  // // input error messages\n  // const [fieldErrors, setFieldErrors] = useState<IFieldErrors>({});\n  // // inpur validation functions\n  // const [fieldValidators] = useState<IFieldValidators>(validators);\n\n  // const initFieldStates = copyAndSetValues(initValues, 'default');\n  // // input states - 'default' | 'success' | 'error'\n  // const [fieldStates, setFieldStates] = useState<any>(initFieldStates);\n\n  // are all validated inputs valid?\n  const isFormValid = useCallback(() => {\n    for (const key in form) {\n      if (form[key].errorMessage) return false;\n    }\n\n    return true;\n  }, [form]);\n\n  // are all required inputs filled?\n  const areRequiredFilled = useCallback(() => {\n    for (const key in form) {\n      const validator = form[key].validator;\n      if (validator) {\n        if (validator.isRequired && !form[key].value) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  }, [form]);\n\n  // callback (on change of input)\n  const onChange = (event: React.FormEvent<HTMLInputElement> | React.FormEvent<HTMLTextAreaElement>) => {\n    const fieldName = event.currentTarget.name;\n    const fieldValue = event.currentTarget.value;\n\n    const newField = { ...form[fieldName], value: fieldValue };\n    const validatedField = validate(newField);\n    setForm({ ...form, [fieldName]: validatedField });\n\n    console.log(fieldValue);\n\n    setHasChanged(true);\n  };\n\n  // validate field\n  const validate = (newField: IFieldState): IFieldState => {\n    const validator = newField.validator;\n    if (validator) {\n      if (validator.isRequired) {\n        const error = newField.value ? '' : 'Field must be filled!';\n        return setError(newField, error);\n      } else if (validator.check) {\n        const error = validator.check(newField.value);\n        return setError(newField, error);\n      }\n    }\n\n    return { ...newField };\n  };\n\n  // set error message and state\n  const setError = (newField: IFieldState, error: string): IFieldState => {\n    if (error) {\n      return { ...newField, errorMessage: error, state: 'error' };\n    } else {\n      // if no error, delete old error (if any)\n      // const newErrors = { ...fieldErrors };\n      // delete newErrors[fieldName];\n      // setFieldErrors(newErrors);\n      // display success state only if not empty\n      if (newField.value) {\n        return { ...newField, errorMessage: error, state: 'success' };\n      } else {\n        return { ...newField, errorMessage: error, state: 'default' };\n      }\n    }\n  };\n\n  const generateSubmitData = (form: IFormState) => {\n    const formData: IFieldValues = {};\n\n    for (const key in form) {\n      formData[key] = form[key].value;\n    }\n\n    return formData;\n  };\n\n  // callback (on submit of form)\n  const onSubmit = () => {\n    callback(generateSubmitData(form));\n    // reset state to 'default' (valid inputs wont be highlighted)\n\n    const formCopy = { ...form };\n    for (const key in formCopy) {\n      formCopy[key].state = 'default';\n    }\n    setForm(formCopy);\n    setIsSubmitDisabled(true);\n  };\n\n  const setFieldValues = useCallback(\n    (fieldValues: IFieldValues) => {\n      const newForm = { ...form };\n      console.log(newForm, fieldValues);\n      for (const key in fieldValues) {\n        console.log(newForm[key], fieldValues[key]);\n        newForm[key]['value'] = fieldValues[key];\n      }\n\n      setForm(newForm);\n    },\n    [form]\n  );\n\n  useEffect(() => {\n    if (isFormValid() && areRequiredFilled() && hasChanged) {\n      setIsSubmitDisabled(false);\n    } else {\n      setIsSubmitDisabled(true);\n    }\n  }, [form, hasChanged, isFormValid, areRequiredFilled]);\n\n  return { form, isSubmitDisabled, onChange, setFieldValues, onSubmit };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}