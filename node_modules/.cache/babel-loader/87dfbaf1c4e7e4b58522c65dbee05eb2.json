{"ast":null,"code":"import { __awaiter, __rest } from \"tslib\";\nimport * as React from 'react';\nimport Dropzone from 'react-dropzone';\nimport { FileUploadField } from './FileUploadField';\nimport { readFile, fileReaderType } from '../../helpers/fileUtils';\nimport { fromEvent } from 'file-selector';\nexport const FileUpload = _a => {\n  var {\n    id,\n    type,\n    value = type === fileReaderType.text || type === fileReaderType.dataURL ? '' : null,\n    filename = '',\n    children = null,\n    onChange = () => {},\n    onFileInputChange = null,\n    onReadStarted = () => {},\n    onReadFinished = () => {},\n    onReadFailed = () => {},\n    onClearClick,\n    onClick = event => event.preventDefault(),\n    onTextChange,\n    onDataChange,\n    dropzoneProps = {}\n  } = _a,\n      props = __rest(_a, [\"id\", \"type\", \"value\", \"filename\", \"children\", \"onChange\", \"onFileInputChange\", \"onReadStarted\", \"onReadFinished\", \"onReadFailed\", \"onClearClick\", \"onClick\", \"onTextChange\", \"onDataChange\", \"dropzoneProps\"]);\n\n  const onDropAccepted = (acceptedFiles, event) => {\n    if (acceptedFiles.length > 0) {\n      const fileHandle = acceptedFiles[0];\n\n      if (event.type === 'drop') {\n        onFileInputChange === null || onFileInputChange === void 0 ? void 0 : onFileInputChange(event, fileHandle);\n      }\n\n      if (type === fileReaderType.text || type === fileReaderType.dataURL) {\n        onChange('', fileHandle.name, event); // Show the filename while reading\n\n        onReadStarted(fileHandle);\n        readFile(fileHandle, type).then(data => {\n          onReadFinished(fileHandle);\n          onChange(data, fileHandle.name, event);\n          onDataChange === null || onDataChange === void 0 ? void 0 : onDataChange(data);\n        }).catch(error => {\n          onReadFailed(error, fileHandle);\n          onReadFinished(fileHandle);\n          onChange('', '', event); // Clear the filename field on a failure\n\n          onDataChange === null || onDataChange === void 0 ? void 0 : onDataChange('');\n        });\n      } else {\n        onChange(fileHandle, fileHandle.name, event);\n      }\n    }\n\n    dropzoneProps.onDropAccepted && dropzoneProps.onDropAccepted(acceptedFiles, event);\n  };\n\n  const onDropRejected = (rejectedFiles, event) => {\n    if (rejectedFiles.length > 0) {\n      onChange('', rejectedFiles[0].name, event);\n    }\n\n    dropzoneProps.onDropRejected && dropzoneProps.onDropRejected(rejectedFiles, event);\n  };\n\n  const fileInputRef = React.useRef();\n\n  const setFileValue = filename => {\n    fileInputRef.current.value = filename;\n  };\n\n  const onClearButtonClick = event => {\n    onChange('', '', event);\n    onClearClick === null || onClearClick === void 0 ? void 0 : onClearClick(event);\n    setFileValue(null);\n  };\n\n  return React.createElement(Dropzone, Object.assign({\n    multiple: false\n  }, dropzoneProps, {\n    onDropAccepted: onDropAccepted,\n    onDropRejected: onDropRejected\n  }), _ref => {\n    let {\n      getRootProps,\n      getInputProps,\n      isDragActive,\n      open\n    } = _ref;\n    const oldInputProps = getInputProps();\n    const inputProps = Object.assign(Object.assign({}, oldInputProps), {\n      onChange: e => __awaiter(void 0, void 0, void 0, function* () {\n        var _a;\n\n        (_a = oldInputProps.onChange) === null || _a === void 0 ? void 0 : _a.call(oldInputProps, e);\n        const files = yield fromEvent(e.nativeEvent);\n\n        if (files.length === 1) {\n          onFileInputChange === null || onFileInputChange === void 0 ? void 0 : onFileInputChange(e, files[0]);\n        }\n      })\n    });\n    return React.createElement(FileUploadField, Object.assign({}, getRootProps(Object.assign(Object.assign({}, props), {\n      refKey: 'containerRef',\n      onClick: event => event.preventDefault()\n    })), {\n      tabIndex: null,\n      id: id,\n      type: type,\n      filename: filename,\n      value: value,\n      onChange: onChange,\n      isDragActive: isDragActive,\n      onBrowseButtonClick: open,\n      onClearButtonClick: onClearButtonClick,\n      onTextAreaClick: onClick,\n      onTextChange: onTextChange\n    }), React.createElement(\"input\", Object.assign({}, inputProps, {\n      ref: input => {\n        fileInputRef.current = input;\n        inputProps.ref(input);\n      }\n    })), children);\n  });\n};\nFileUpload.displayName = 'FileUpload';","map":{"version":3,"mappings":"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","names":["React","Dropzone","FileUploadField","readFile","fileReaderType","fromEvent","FileUpload","_a","id","type","value","text","dataURL","filename","children","onChange","onFileInputChange","onReadStarted","onReadFinished","onReadFailed","onClearClick","onClick","event","preventDefault","onTextChange","onDataChange","dropzoneProps","props","onDropAccepted","acceptedFiles","length","fileHandle","name","then","data","catch","error","onDropRejected","rejectedFiles","fileInputRef","useRef","setFileValue","current","onClearButtonClick","Object","multiple","getRootProps","getInputProps","isDragActive","open","oldInputProps","inputProps","e","__awaiter","files","nativeEvent","refKey","tabIndex","onBrowseButtonClick","onTextAreaClick","ref","input","displayName"],"sources":["/home/pkorytar/Projects/RedHat/pnc-web-ui-react/node_modules/@patternfly/react-core/src/components/FileUpload/FileUpload.tsx"],"sourcesContent":["import * as React from 'react';\nimport Dropzone, { DropzoneProps, DropzoneInputProps, DropFileEventHandler } from 'react-dropzone';\nimport { FileUploadField, FileUploadFieldProps } from './FileUploadField';\nimport { readFile, fileReaderType } from '../../helpers/fileUtils';\nimport { fromEvent } from 'file-selector';\n\ninterface DropzoneInputPropsWithRef extends DropzoneInputProps {\n  ref: React.RefCallback<HTMLInputElement>; // Working around an issue in react-dropzone 9.0.0's types. Should not be necessary in later versions.\n}\n\nexport interface FileUploadProps\n  extends Omit<\n    FileUploadFieldProps,\n    'children' | 'onBrowseButtonClick' | 'onClearButtonClick' | 'isDragActive' | 'containerRef'\n  > {\n  /** Unique id for the TextArea, also used to generate ids for accessible labels. */\n  id: string;\n  /** What type of file. Determines what is is passed to `onChange` and expected by `value`\n   * (a string for 'text' and 'dataURL', or a File object otherwise. */\n  type?: 'text' | 'dataURL';\n  /** Value of the file's contents\n   * (string if text file, File object otherwise) */\n  value?: string | File;\n  /** Value to be shown in the read-only filename field. */\n  filename?: string;\n  /** @deprecated A callback for when the file contents change. Please instead use onFileInputChange, onTextChange, onDataChange, onClearClick individually.  */\n  onChange?: (\n    value: string | File,\n    filename: string,\n    event:\n      | React.MouseEvent<HTMLButtonElement, MouseEvent> // Clear button was clicked\n      | React.DragEvent<HTMLElement> // User dragged/dropped a file\n      | React.ChangeEvent<HTMLElement> // User typed in the TextArea\n  ) => void;\n  /** Change event emitted from the hidden \\<input type=\"file\" \\> field associated with the component  */\n  onFileInputChange?: (event: React.ChangeEvent<HTMLInputElement> | React.DragEvent<HTMLElement>, file: File) => void;\n  /** Callback for clicking on the FileUploadField text area. By default, prevents a click in the text area from opening file dialog. */\n  onClick?: (event: React.MouseEvent) => void;\n  /** Additional classes added to the FileUpload container element. */\n  className?: string;\n  /** Flag to show if the field is disabled. */\n  isDisabled?: boolean;\n  /** Flag to show if the field is read only. */\n  isReadOnly?: boolean;\n  /** Flag to show if a file is being loaded. */\n  isLoading?: boolean;\n  /** Aria-valuetext for the loading spinner */\n  spinnerAriaValueText?: string;\n  /** Flag to show if the field is required. */\n  isRequired?: boolean;\n  /** Value to indicate if the field is modified to show that validation state.\n   * If set to success, field will be modified to indicate valid state.\n   * If set to error,  field will be modified to indicate error state.\n   */\n  validated?: 'success' | 'error' | 'default';\n  /** Aria-label for the TextArea. */\n  'aria-label'?: string;\n  /** Placeholder string to display in the empty filename field */\n  filenamePlaceholder?: string;\n  /** Aria-label for the read-only filename field */\n  filenameAriaLabel?: string;\n  /** Text for the Browse button */\n  browseButtonText?: string;\n  /** Text for the Clear button */\n  clearButtonText?: string;\n  /** Flag to hide the built-in preview of the file (where available).\n   * If true, you can use children to render an alternate preview. */\n  hideDefaultPreview?: boolean;\n  /** Flag to allow editing of a text file's contents after it is selected from disk */\n  allowEditingUploadedText?: boolean;\n  /** Additional children to render after (or instead of) the file preview. */\n  children?: React.ReactNode;\n\n  // Props available in FileUpload but not FileUploadField:\n\n  /** A callback for when a selected file starts loading */\n  onReadStarted?: (fileHandle: File) => void;\n  /** A callback for when a selected file finishes loading */\n  onReadFinished?: (fileHandle: File) => void;\n  /** A callback for when the FileReader API fails */\n  onReadFailed?: (error: DOMException, fileHandle: File) => void;\n  /** Optional extra props to customize react-dropzone. */\n  dropzoneProps?: DropzoneProps;\n  /** Clear button was clicked */\n  onClearClick?: React.MouseEventHandler<HTMLButtonElement>;\n  /** Text area text changed */\n  onTextChange?: (text: string) => void;\n  /** On data changed - if type='text' or type='dataURL' and file was loaded it will call this method */\n  onDataChange?: (data: string) => void;\n}\n\nexport const FileUpload: React.FunctionComponent<FileUploadProps> = ({\n  id,\n  type,\n  value = type === fileReaderType.text || type === fileReaderType.dataURL ? '' : null,\n  filename = '',\n  children = null,\n  onChange = () => {},\n  onFileInputChange = null,\n  onReadStarted = () => {},\n  onReadFinished = () => {},\n  onReadFailed = () => {},\n  onClearClick,\n  onClick = event => event.preventDefault(),\n  onTextChange,\n  onDataChange,\n  dropzoneProps = {},\n  ...props\n}: FileUploadProps) => {\n  const onDropAccepted: DropFileEventHandler = (acceptedFiles, event) => {\n    if (acceptedFiles.length > 0) {\n      const fileHandle = acceptedFiles[0];\n      if (event.type === 'drop') {\n        onFileInputChange?.(event, fileHandle);\n      }\n      if (type === fileReaderType.text || type === fileReaderType.dataURL) {\n        onChange('', fileHandle.name, event); // Show the filename while reading\n        onReadStarted(fileHandle);\n        readFile(fileHandle, type as fileReaderType)\n          .then(data => {\n            onReadFinished(fileHandle);\n            onChange(data as string, fileHandle.name, event);\n            onDataChange?.(data as string);\n          })\n          .catch((error: DOMException) => {\n            onReadFailed(error, fileHandle);\n            onReadFinished(fileHandle);\n            onChange('', '', event); // Clear the filename field on a failure\n            onDataChange?.('');\n          });\n      } else {\n        onChange(fileHandle, fileHandle.name, event);\n      }\n    }\n    dropzoneProps.onDropAccepted && dropzoneProps.onDropAccepted(acceptedFiles, event);\n  };\n\n  const onDropRejected: DropFileEventHandler = (rejectedFiles, event) => {\n    if (rejectedFiles.length > 0) {\n      onChange('', rejectedFiles[0].name, event);\n    }\n    dropzoneProps.onDropRejected && dropzoneProps.onDropRejected(rejectedFiles, event);\n  };\n\n  const fileInputRef = React.useRef<HTMLInputElement>();\n  const setFileValue = (filename: string) => {\n    fileInputRef.current.value = filename;\n  };\n\n  const onClearButtonClick = (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    onChange('', '', event);\n    onClearClick?.(event);\n    setFileValue(null);\n  };\n\n  return (\n    <Dropzone multiple={false} {...dropzoneProps} onDropAccepted={onDropAccepted} onDropRejected={onDropRejected}>\n      {({ getRootProps, getInputProps, isDragActive, open }) => {\n        const oldInputProps = getInputProps();\n        const inputProps: DropzoneInputProps = {\n          ...oldInputProps,\n          onChange: async (e: React.ChangeEvent<HTMLInputElement>) => {\n            oldInputProps.onChange?.(e);\n            const files = await fromEvent(e.nativeEvent);\n            if (files.length === 1) {\n              onFileInputChange?.(e, files[0] as File);\n            }\n          }\n        };\n\n        return (\n          <FileUploadField\n            {...getRootProps({\n              ...props,\n              refKey: 'containerRef',\n              onClick: event => event.preventDefault()\n            })}\n            tabIndex={null} // Omit the unwanted tabIndex from react-dropzone's getRootProps\n            id={id}\n            type={type}\n            filename={filename}\n            value={value}\n            onChange={onChange}\n            isDragActive={isDragActive}\n            onBrowseButtonClick={open}\n            onClearButtonClick={onClearButtonClick}\n            onTextAreaClick={onClick}\n            onTextChange={onTextChange}\n          >\n            <input\n              /* hidden, necessary for react-dropzone */\n              {...inputProps}\n              ref={input => {\n                fileInputRef.current = input;\n                (inputProps as DropzoneInputPropsWithRef).ref(input);\n              }}\n            />\n            {children}\n          </FileUploadField>\n        );\n      }}\n    </Dropzone>\n  );\n};\nFileUpload.displayName = 'FileUpload';\n"]},"metadata":{},"sourceType":"module"}