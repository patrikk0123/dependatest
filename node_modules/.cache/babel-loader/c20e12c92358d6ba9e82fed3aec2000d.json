{"ast":null,"code":"import { useCallback, useEffect, useState } from 'react';\n\n/**\n * Hook to manage input values, validation and states of a form.\n * All validation is done on change of input.\n * Submit button is firstly disabled. In order to enable button:\n *  -> at least one change must be done (not possible to submit unchanged edit form)\n *  -> all required fields must not be empty\n *  -> all validated inputs must be valid\n *\n * See also {@link ProjectCreateEditPage}\n *\n * @param initForm - Init form state (just values and validators)\n * @param callback - Function to call when submitting user input data\n *\n * @returns form states and access functions\n *  -> form             - whole form state\n *  -> applyValues      - set all field values\n *  -> onChange         - callback for input fields on change\n *  -> onSubmit         - callback for submit button\n *  -> isSubmitDisabled - submit disabled or not\n *\n * initForm and form objects hold whole state of a form.\n * their structure:\n *  -> [key]:   -- input field ID\n *    -> value  -- field value\n *    -> errorMessage -- error message (in case of a error)\n *    -> state  -- state of a field ('default', 'success', 'error')\n *    -> validator:   -- means of validation\n *      -> isRequired -- is field required?\n *      -> check      -- function to check format of an input\n */\nexport const useForm = (initForm, callback) => {\n  const defaultForm = { ...initForm\n  };\n\n  for (const key in defaultForm) {\n    defaultForm[key].state = 'default';\n  }\n\n  const [form, setForm] = useState(defaultForm); // is submit button disabled?\n\n  const [isSubmitDisabled, setIsSubmitDisabled] = useState(true); // has any field been changed?\n  // important for edit page (do not submit until any new content)\n\n  const [hasChanged, setHasChanged] = useState(false); // are all validated inputs valid?\n\n  const isFormValid = useCallback(() => {\n    for (const key in form) {\n      var _form$key$errorMessag;\n\n      if ((_form$key$errorMessag = form[key].errorMessages) !== null && _form$key$errorMessag !== void 0 && _form$key$errorMessag.length) return false;\n    }\n\n    return true;\n  }, [form]); // are all required inputs filled?\n\n  const areRequiredFilled = useCallback(() => {\n    for (const key in form) {\n      const validation = form[key].validation;\n\n      if (validation.isRequired && !form[key].value) {\n        return false;\n      }\n    }\n\n    return true;\n  }, [form]); // callback (on change of input)\n\n  const onChange = (fieldName, fieldValue) => {\n    const newFieldState = { ...form[fieldName],\n      value: fieldValue\n    };\n    const validatedFieldState = validate(newFieldState);\n    setForm({ ...form,\n      [fieldName]: validatedFieldState\n    });\n    setHasChanged(true);\n  }; // validate field state and return new with errors / new state\n\n\n  const validate = fieldState => {\n    const validator = fieldState.validator;\n\n    if (validator) {\n      if (validator.isRequired) {\n        const error = fieldState.value ? '' : 'Field must be filled!';\n        return setError(fieldState, error);\n      } else if (validator.check) {\n        const error = validator.check(fieldState.value);\n        return setError(fieldState, error);\n      }\n    }\n\n    return { ...fieldState\n    };\n  }; // create new field state and apply errors / state and return it\n\n\n  const setError = (fieldState, error) => {\n    if (error) {\n      return { ...fieldState,\n        errorMessage: error,\n        state: 'error'\n      };\n    } else {\n      // display success state only if not empty\n      if (fieldState.value) {\n        return { ...fieldState,\n          errorMessage: error,\n          state: 'success'\n        };\n      } else {\n        return { ...fieldState,\n          errorMessage: error,\n          state: 'default'\n        };\n      }\n    }\n  }; // callback (on submit of form)\n\n\n  const onSubmit = () => {\n    callback().catch(error => {\n      // backend error, just log it at the moment\n      console.error(error); // FUTURE IMPLEMENTATION:\n      // const formCopy = { ...form };\n      // for (const key in error.details.validation) {\n      //   const newField = { ...form[key], error: error.details.validation[key].errorMessage, state: 'error' };\n      //   formCopy[key] = newField;\n      // }\n      // setForm(formCopy);\n    }); // reset state to 'default' (valid inputs wont be highlighted)\n\n    const formCopy = { ...form\n    };\n\n    for (const key in formCopy) {\n      formCopy[key].state = 'default';\n    }\n\n    setForm(formCopy);\n    setIsSubmitDisabled(true);\n  }; // set all input field to values (used for edit form)\n\n\n  const applyValues = useCallback(fieldValues => {\n    const newForm = { ...form\n    };\n\n    for (const key in fieldValues) {\n      newForm[key].value = fieldValues[key];\n    }\n\n    setForm(newForm);\n  }, [form]); // on change of a input, check whether submit button should be disabled\n\n  useEffect(() => {\n    if (isFormValid() && areRequiredFilled() && hasChanged) {\n      setIsSubmitDisabled(false);\n    } else {\n      setIsSubmitDisabled(true);\n    }\n  }, [form, hasChanged, isFormValid, areRequiredFilled]);\n  return {\n    form,\n    applyValues,\n    onChange,\n    onSubmit,\n    isSubmitDisabled\n  };\n};","map":{"version":3,"names":["useCallback","useEffect","useState","useForm","initForm","callback","defaultForm","key","state","form","setForm","isSubmitDisabled","setIsSubmitDisabled","hasChanged","setHasChanged","isFormValid","errorMessages","length","areRequiredFilled","validation","isRequired","value","onChange","fieldName","fieldValue","newFieldState","validatedFieldState","validate","fieldState","validator","error","setError","check","errorMessage","onSubmit","catch","console","formCopy","applyValues","fieldValues","newForm"],"sources":["/home/pkorytar/Projects/RedHat/pnc-web-ui-react/src/containers/useForm.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\n\nexport interface IFieldValues {\n  [key: string]: string;\n}\n\ninterface IValidator {\n  check: Function;\n  errorMessage: string;\n}\n\ninterface IValidation {\n  isRequired?: boolean;\n  validators?: IValidator[];\n}\n\ninterface IFieldState {\n  value: string;\n  errorMessages?: string[];\n  state?: any;\n  validation?: IValidation;\n}\n\nexport interface IFormState {\n  [key: string]: IFieldState;\n}\n\n/**\n * Hook to manage input values, validation and states of a form.\n * All validation is done on change of input.\n * Submit button is firstly disabled. In order to enable button:\n *  -> at least one change must be done (not possible to submit unchanged edit form)\n *  -> all required fields must not be empty\n *  -> all validated inputs must be valid\n *\n * See also {@link ProjectCreateEditPage}\n *\n * @param initForm - Init form state (just values and validators)\n * @param callback - Function to call when submitting user input data\n *\n * @returns form states and access functions\n *  -> form             - whole form state\n *  -> applyValues      - set all field values\n *  -> onChange         - callback for input fields on change\n *  -> onSubmit         - callback for submit button\n *  -> isSubmitDisabled - submit disabled or not\n *\n * initForm and form objects hold whole state of a form.\n * their structure:\n *  -> [key]:   -- input field ID\n *    -> value  -- field value\n *    -> errorMessage -- error message (in case of a error)\n *    -> state  -- state of a field ('default', 'success', 'error')\n *    -> validator:   -- means of validation\n *      -> isRequired -- is field required?\n *      -> check      -- function to check format of an input\n */\nexport const useForm = (initForm: Omit<Omit<IFormState, 'errorMessage'>, 'state'>, callback: Function) => {\n  const defaultForm = { ...initForm };\n  for (const key in defaultForm) {\n    defaultForm[key].state = 'default';\n  }\n  const [form, setForm] = useState<IFormState>(defaultForm);\n\n  // is submit button disabled?\n  const [isSubmitDisabled, setIsSubmitDisabled] = useState<boolean>(true);\n  // has any field been changed?\n  // important for edit page (do not submit until any new content)\n  const [hasChanged, setHasChanged] = useState<boolean>(false);\n\n  // are all validated inputs valid?\n  const isFormValid = useCallback(() => {\n    for (const key in form) {\n      if (form[key].errorMessages?.length) return false;\n    }\n\n    return true;\n  }, [form]);\n\n  // are all required inputs filled?\n  const areRequiredFilled = useCallback(() => {\n    for (const key in form) {\n      const validation = form[key].validation;\n      if (validation.isRequired && !form[key].value) {\n        return false;\n      }\n    }\n\n    return true;\n  }, [form]);\n\n  // callback (on change of input)\n  const onChange = (fieldName: any, fieldValue: any) => {\n    const newFieldState = { ...form[fieldName], value: fieldValue };\n    const validatedFieldState = validate(newFieldState);\n    setForm({ ...form, [fieldName]: validatedFieldState });\n\n    setHasChanged(true);\n  };\n\n  // validate field state and return new with errors / new state\n  const validate = (fieldState: IFieldState): IFieldState => {\n    const validator = fieldState.validator;\n    if (validator) {\n      if (validator.isRequired) {\n        const error = fieldState.value ? '' : 'Field must be filled!';\n        return setError(fieldState, error);\n      } else if (validator.check) {\n        const error = validator.check(fieldState.value);\n        return setError(fieldState, error);\n      }\n    }\n\n    return { ...fieldState };\n  };\n\n  // create new field state and apply errors / state and return it\n  const setError = (fieldState: IFieldState, error: string): IFieldState => {\n    if (error) {\n      return { ...fieldState, errorMessage: error, state: 'error' };\n    } else {\n      // display success state only if not empty\n      if (fieldState.value) {\n        return { ...fieldState, errorMessage: error, state: 'success' };\n      } else {\n        return { ...fieldState, errorMessage: error, state: 'default' };\n      }\n    }\n  };\n\n  // callback (on submit of form)\n  const onSubmit = () => {\n    callback().catch((error: any) => {\n      // backend error, just log it at the moment\n      console.error(error);\n\n      // FUTURE IMPLEMENTATION:\n      // const formCopy = { ...form };\n      // for (const key in error.details.validation) {\n      //   const newField = { ...form[key], error: error.details.validation[key].errorMessage, state: 'error' };\n      //   formCopy[key] = newField;\n      // }\n      // setForm(formCopy);\n    });\n\n    // reset state to 'default' (valid inputs wont be highlighted)\n    const formCopy = { ...form };\n    for (const key in formCopy) {\n      formCopy[key].state = 'default';\n    }\n    setForm(formCopy);\n    setIsSubmitDisabled(true);\n  };\n\n  // set all input field to values (used for edit form)\n  const applyValues = useCallback(\n    (fieldValues: IFieldValues) => {\n      const newForm = { ...form };\n      for (const key in fieldValues) {\n        newForm[key].value = fieldValues[key];\n      }\n\n      setForm(newForm);\n    },\n    [form]\n  );\n\n  // on change of a input, check whether submit button should be disabled\n  useEffect(() => {\n    if (isFormValid() && areRequiredFilled() && hasChanged) {\n      setIsSubmitDisabled(false);\n    } else {\n      setIsSubmitDisabled(true);\n    }\n  }, [form, hasChanged, isFormValid, areRequiredFilled]);\n\n  return { form, applyValues, onChange, onSubmit, isSubmitDisabled };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}